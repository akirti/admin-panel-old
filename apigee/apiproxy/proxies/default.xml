<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<ProxyEndpoint name="default">
    <Description>Default Proxy Endpoint for EasyLife Admin API</Description>

    <PreFlow name="PreFlow">
        <Request>
            <!-- CORS Preflight handling -->
            <Step>
                <Name>RF-CORSPreflight</Name>
                <Condition>request.verb == "OPTIONS"</Condition>
            </Step>
            <!-- Spike Arrest to prevent abuse -->
            <Step>
                <Name>SA-RateLimit</Name>
            </Step>
            <!-- Verify API Key for non-auth endpoints -->
            <Step>
                <Name>VA-VerifyAPIKey</Name>
                <Condition>!(proxy.pathsuffix MatchesPath "/auth/**") and !(proxy.pathsuffix MatchesPath "/health/**") and !(proxy.pathsuffix MatchesPath "/info")</Condition>
            </Step>
            <!-- Validate JWT Token for protected endpoints -->
            <Step>
                <Name>JWT-VerifyAccessToken</Name>
                <Condition>!(proxy.pathsuffix MatchesPath "/auth/login") and !(proxy.pathsuffix MatchesPath "/auth/register") and !(proxy.pathsuffix MatchesPath "/auth/forgot_password") and !(proxy.pathsuffix MatchesPath "/auth/reset_password") and !(proxy.pathsuffix MatchesPath "/auth/csrf-token") and !(proxy.pathsuffix MatchesPath "/health/**") and !(proxy.pathsuffix MatchesPath "/info") and !(proxy.pathsuffix MatchesPath "/feedback/public") and request.verb != "OPTIONS"</Condition>
            </Step>
            <!-- Quota enforcement -->
            <Step>
                <Name>Q-EnforceQuota</Name>
                <Condition>!(proxy.pathsuffix MatchesPath "/health/**") and !(proxy.pathsuffix MatchesPath "/info")</Condition>
            </Step>
        </Request>
        <Response>
            <!-- Add CORS headers -->
            <Step>
                <Name>AM-AddCORSHeaders</Name>
            </Step>
        </Response>
    </PreFlow>

    <Flows>
        <!-- ==================== Authentication Endpoints ==================== -->
        <Flow name="Auth-CSRF">
            <Description>Get CSRF token</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/auth/csrf-token") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Auth-Login">
            <Description>User login</Description>
            <Request>
                <Step>
                    <Name>JS-ValidateLoginRequest</Name>
                </Step>
            </Request>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/auth/login") and (request.verb = "POST")</Condition>
        </Flow>

        <Flow name="Auth-Register">
            <Description>User registration</Description>
            <Request>
                <Step>
                    <Name>JS-ValidateRegisterRequest</Name>
                </Step>
            </Request>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/auth/register") and (request.verb = "POST")</Condition>
        </Flow>

        <Flow name="Auth-Refresh">
            <Description>Token refresh</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/auth/refresh") and (request.verb = "POST")</Condition>
        </Flow>

        <Flow name="Auth-Profile">
            <Description>Get or update user profile</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/auth/profile") and (request.verb = "GET" or request.verb = "PUT")</Condition>
        </Flow>

        <Flow name="Auth-ForgotPassword">
            <Description>Forgot password request</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/auth/forgot_password") and (request.verb = "POST")</Condition>
        </Flow>

        <Flow name="Auth-ResetPassword">
            <Description>Reset password</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/auth/reset_password") and (request.verb = "POST")</Condition>
        </Flow>

        <Flow name="Auth-UpdatePassword">
            <Description>Update password</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/auth/update_password") and (request.verb = "POST")</Condition>
        </Flow>

        <Flow name="Auth-Logout">
            <Description>User logout</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/auth/logout") and (request.verb = "POST")</Condition>
        </Flow>

        <!-- ==================== User Management Endpoints ==================== -->
        <Flow name="Users-List">
            <Description>List all users</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/users") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Users-Count">
            <Description>Get users count</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/users/count") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Users-Create">
            <Description>Create a new user</Description>
            <Request>
                <Step>
                    <Name>JS-ValidateUserCreate</Name>
                </Step>
            </Request>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/users") and (request.verb = "POST")</Condition>
        </Flow>

        <Flow name="Users-AssignedCustomers">
            <Description>Get current user assigned customers</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/users/me/assigned-customers") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Users-CustomerTags">
            <Description>Get current user customer tags</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/users/me/customer-tags") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Users-GetById">
            <Description>Get user by ID</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/users/*") and (request.verb = "GET") and !(proxy.pathsuffix MatchesPath "/users/count")</Condition>
        </Flow>

        <Flow name="Users-Update">
            <Description>Update user</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/users/*") and (request.verb = "PUT")</Condition>
        </Flow>

        <Flow name="Users-Delete">
            <Description>Delete user</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/users/*") and (request.verb = "DELETE")</Condition>
        </Flow>

        <Flow name="Users-ToggleStatus">
            <Description>Toggle user status</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/users/*/toggle-status") and (request.verb = "POST")</Condition>
        </Flow>

        <Flow name="Users-SendPasswordReset">
            <Description>Send password reset email</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/users/*/send-password-reset") and (request.verb = "POST")</Condition>
        </Flow>

        <Flow name="Users-ResetPassword">
            <Description>Admin reset user password</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/users/*/reset-password") and (request.verb = "POST")</Condition>
        </Flow>

        <!-- ==================== Admin Management Endpoints ==================== -->
        <Flow name="Admin-Management">
            <Description>Admin management operations</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/admin/management/**")</Condition>
        </Flow>

        <!-- ==================== Roles Endpoints ==================== -->
        <Flow name="Roles-List">
            <Description>List all roles</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/roles") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Roles-Count">
            <Description>Get roles count</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/roles/count") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Roles-ToggleStatus">
            <Description>Toggle role status</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/roles/*/toggle-status") and (request.verb = "POST")</Condition>
        </Flow>

        <Flow name="Roles-Users">
            <Description>Get users with a role</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/roles/*/users") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Roles-CRUD">
            <Description>Roles CRUD operations</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/roles/*")</Condition>
        </Flow>

        <!-- ==================== Groups Endpoints ==================== -->
        <Flow name="Groups-List">
            <Description>List all groups</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/groups") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Groups-Count">
            <Description>Get groups count</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/groups/count") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Groups-Types">
            <Description>Get group types</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/groups/types") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Groups-ToggleStatus">
            <Description>Toggle group status</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/groups/*/toggle-status") and (request.verb = "POST")</Condition>
        </Flow>

        <Flow name="Groups-Users">
            <Description>Get users in a group</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/groups/*/users") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Groups-CRUD">
            <Description>Groups CRUD operations</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/groups/*")</Condition>
        </Flow>

        <!-- ==================== Permissions Endpoints ==================== -->
        <Flow name="Permissions-List">
            <Description>List all permissions</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/permissions") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Permissions-Modules">
            <Description>Get permission modules</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/permissions/modules") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Permissions-Count">
            <Description>Get permissions count</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/permissions/count") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Permissions-Roles">
            <Description>Get roles with a permission</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/permissions/*/roles") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Permissions-Groups">
            <Description>Get groups with a permission</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/permissions/*/groups") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Permissions-CRUD">
            <Description>Permissions CRUD operations</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/permissions/*")</Condition>
        </Flow>

        <!-- ==================== Domains Endpoints ==================== -->
        <Flow name="Domains-All">
            <Description>Get all domains</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/domains/all") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Domains-AdminAll">
            <Description>Admin get all domains</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/domains/admin/all") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Domains-List">
            <Description>List domains with pagination</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/domains") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Domains-Count">
            <Description>Get domains count</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/domains/count") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Domains-Types">
            <Description>Get domain types</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/domains/types") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Domains-ToggleStatus">
            <Description>Toggle domain status</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/domains/*/toggle-status") and (request.verb = "POST")</Condition>
        </Flow>

        <Flow name="Domains-Subdomains">
            <Description>Manage domain subdomains</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/domains/*/subdomains") or (proxy.pathsuffix MatchesPath "/domains/*/subdomains/*")</Condition>
        </Flow>

        <Flow name="Domains-Scenarios">
            <Description>Get scenarios for a domain</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/domains/*/scenarios") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Domains-CRUD">
            <Description>Domains CRUD operations</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/domains/*")</Condition>
        </Flow>

        <!-- ==================== Domain Scenarios Endpoints ==================== -->
        <Flow name="DomainScenarios-List">
            <Description>List domain scenarios</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/domain-scenarios") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="DomainScenarios-Count">
            <Description>Get domain scenarios count</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/domain-scenarios/count") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="DomainScenarios-ToggleStatus">
            <Description>Toggle domain scenario status</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/domain-scenarios/*/toggle-status") and (request.verb = "POST")</Condition>
        </Flow>

        <Flow name="DomainScenarios-Subdomains">
            <Description>Manage domain scenario subdomains</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/domain-scenarios/*/subdomains") or (proxy.pathsuffix MatchesPath "/domain-scenarios/*/subdomains/*")</Condition>
        </Flow>

        <Flow name="DomainScenarios-Playboards">
            <Description>Get playboards for a domain scenario</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/domain-scenarios/*/playboards") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="DomainScenarios-CRUD">
            <Description>Domain scenarios CRUD operations</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/domain-scenarios/*")</Condition>
        </Flow>

        <!-- ==================== Scenarios Endpoints ==================== -->
        <Flow name="Scenarios-All">
            <Description>Get all scenarios</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/scenarios/all") or (proxy.pathsuffix MatchesPath "/scenarios/all/*")</Condition>
        </Flow>

        <Flow name="Scenarios-CRUD">
            <Description>Scenarios CRUD operations</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/scenarios") or (proxy.pathsuffix MatchesPath "/scenarios/*")</Condition>
        </Flow>

        <!-- ==================== Scenario Requests (Ask Scenarios) Endpoints ==================== -->
        <Flow name="AskScenarios-Lookups">
            <Description>Scenario request lookup data</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/ask_scenarios/lookup/**")</Condition>
        </Flow>

        <Flow name="AskScenarios-All">
            <Description>Get all scenario requests</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/ask_scenarios/all") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="AskScenarios-AdminUpdate">
            <Description>Admin update scenario request</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/ask_scenarios/*/admin") and (request.verb = "PUT")</Condition>
        </Flow>

        <Flow name="AskScenarios-StatusUpdate">
            <Description>Update scenario request status</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/ask_scenarios/*/status") and (request.verb = "PUT")</Condition>
        </Flow>

        <Flow name="AskScenarios-Files">
            <Description>Upload files to scenario request</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/ask_scenarios/*/files") and (request.verb = "POST")</Condition>
        </Flow>

        <Flow name="AskScenarios-FileAccess">
            <Description>Preview or download scenario request files</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/ask_scenarios/*/files/**")</Condition>
        </Flow>

        <Flow name="AskScenarios-Buckets">
            <Description>Upload bucket files to scenario request</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/ask_scenarios/*/buckets") and (request.verb = "POST")</Condition>
        </Flow>

        <Flow name="AskScenarios-Comment">
            <Description>Add comment to scenario request</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/ask_scenarios/*/comment") and (request.verb = "POST")</Condition>
        </Flow>

        <Flow name="AskScenarios-Workflow">
            <Description>Add workflow entry to scenario request</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/ask_scenarios/*/workflow") and (request.verb = "POST")</Condition>
        </Flow>

        <Flow name="AskScenarios-CRUD">
            <Description>Scenario requests CRUD operations</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/ask_scenarios") or (proxy.pathsuffix MatchesPath "/ask_scenarios/*")</Condition>
        </Flow>

        <!-- ==================== Playboards Endpoints ==================== -->
        <Flow name="Playboards-List">
            <Description>List playboards</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/playboards") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Playboards-Count">
            <Description>Get playboards count</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/playboards/count") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Playboards-Upload">
            <Description>Upload playboard</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/playboards/upload") and (request.verb = "POST")</Condition>
        </Flow>

        <Flow name="Playboards-ToggleStatus">
            <Description>Toggle playboard status</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/playboards/*/toggle-status") and (request.verb = "POST")</Condition>
        </Flow>

        <Flow name="Playboards-Download">
            <Description>Download playboard JSON</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/playboards/*/download") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Playboards-UploadById">
            <Description>Upload JSON to update playboard</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/playboards/*/upload") and (request.verb = "PUT")</Condition>
        </Flow>

        <Flow name="Playboards-CRUD">
            <Description>Playboards CRUD operations</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/playboards/*")</Condition>
        </Flow>

        <!-- ==================== Configurations Endpoints ==================== -->
        <Flow name="Configurations-List">
            <Description>List configurations</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/configurations") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Configurations-Count">
            <Description>Get configurations count</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/configurations/count") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Configurations-Types">
            <Description>Get configuration types</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/configurations/types") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Configurations-Upload">
            <Description>Upload configuration file</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/configurations/upload") and (request.verb = "POST")</Condition>
        </Flow>

        <Flow name="Configurations-GCSStatus">
            <Description>Get GCS status for configurations</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/configurations/gcs/status") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Configurations-Download">
            <Description>Download configuration file</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/configurations/*/download") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Configurations-Versions">
            <Description>Get configuration file versions</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/configurations/*/versions") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Configurations-CRUD">
            <Description>Configurations CRUD operations</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/configurations/*")</Condition>
        </Flow>

        <!-- ==================== API Configurations Endpoints ==================== -->
        <Flow name="ApiConfigs-List">
            <Description>List API configurations</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/api-configs") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="ApiConfigs-Create">
            <Description>Create API configuration</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/api-configs") and (request.verb = "POST")</Condition>
        </Flow>

        <Flow name="ApiConfigs-Count">
            <Description>Get API configurations count</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/api-configs/count") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="ApiConfigs-Tags">
            <Description>Get API configuration tags</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/api-configs/tags") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="ApiConfigs-Test">
            <Description>Test API configuration</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/api-configs/test") and (request.verb = "POST")</Condition>
        </Flow>

        <Flow name="ApiConfigs-GCSStatus">
            <Description>Get GCS status for API configs</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/api-configs/gcs/status") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="ApiConfigs-GetByKey">
            <Description>Get API configuration by key</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/api-configs/key/*") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="ApiConfigs-GetById">
            <Description>Get API configuration by ID</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/api-configs/*") and (request.verb = "GET") and !(proxy.pathsuffix MatchesPath "/api-configs/count") and !(proxy.pathsuffix MatchesPath "/api-configs/tags") and !(proxy.pathsuffix MatchesPath "/api-configs/test") and !(proxy.pathsuffix MatchesPath "/api-configs/gcs/*") and !(proxy.pathsuffix MatchesPath "/api-configs/key/*")</Condition>
        </Flow>

        <Flow name="ApiConfigs-Update">
            <Description>Update API configuration</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/api-configs/*") and (request.verb = "PUT")</Condition>
        </Flow>

        <Flow name="ApiConfigs-Delete">
            <Description>Delete API configuration</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/api-configs/*") and (request.verb = "DELETE")</Condition>
        </Flow>

        <Flow name="ApiConfigs-ToggleStatus">
            <Description>Toggle API configuration status</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/api-configs/*/toggle-status") and (request.verb = "POST")</Condition>
        </Flow>

        <Flow name="ApiConfigs-TestById">
            <Description>Test API configuration by ID</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/api-configs/*/test") and (request.verb = "POST")</Condition>
        </Flow>

        <Flow name="ApiConfigs-UploadCert">
            <Description>Upload certificate for API configuration</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/api-configs/*/upload-cert") and (request.verb = "POST")</Condition>
        </Flow>

        <!-- ==================== Customers Endpoints ==================== -->
        <Flow name="Customers-List">
            <Description>List customers</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/customers") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Customers-Count">
            <Description>Get customers count</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/customers/count") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Customers-Filters">
            <Description>Get customer filter options</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/customers/filters") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Customers-ToggleStatus">
            <Description>Toggle customer status</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/customers/*/toggle-status") and (request.verb = "POST")</Condition>
        </Flow>

        <Flow name="Customers-Users">
            <Description>Get users assigned to a customer</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/customers/*/users") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Customers-AssignUsers">
            <Description>Assign users to a customer</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/customers/*/assign-users") and (request.verb = "POST")</Condition>
        </Flow>

        <Flow name="Customers-RemoveUsers">
            <Description>Remove users from a customer</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/customers/*/remove-users") and (request.verb = "POST")</Condition>
        </Flow>

        <Flow name="Customers-CRUD">
            <Description>Customers CRUD operations</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/customers/*")</Condition>
        </Flow>

        <!-- ==================== Feedback Endpoints ==================== -->
        <Flow name="Feedback-Public">
            <Description>Submit public feedback (no auth required)</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/feedback/public") and (request.verb = "POST")</Condition>
        </Flow>

        <Flow name="Feedback-Stats">
            <Description>Get feedback statistics</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/feedback/stats") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Feedback-All">
            <Description>Get all feedback</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/feedback/all") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Feedback-AdminList">
            <Description>Admin list feedback with pagination</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/feedback/admin/list") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Feedback-CRUD">
            <Description>Feedback CRUD operations</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/feedback") or (proxy.pathsuffix MatchesPath "/feedback/*")</Condition>
        </Flow>

        <!-- ==================== Dashboard Endpoints ==================== -->
        <Flow name="Dashboard-Stats">
            <Description>Get dashboard statistics</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/dashboard/stats") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Dashboard-Summary">
            <Description>Get dashboard summary</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/dashboard/summary") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Dashboard-RecentLogins">
            <Description>Get recent logins</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/dashboard/recent-logins") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Dashboard-Analytics">
            <Description>Get dashboard analytics</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/dashboard/analytics") and (request.verb = "GET")</Condition>
        </Flow>

        <!-- ==================== Activity Logs Endpoints ==================== -->
        <Flow name="ActivityLogs-List">
            <Description>List activity logs</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/activity-logs") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="ActivityLogs-Stats">
            <Description>Get activity logs statistics</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/activity-logs/stats") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="ActivityLogs-Actions">
            <Description>Get available actions</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/activity-logs/actions") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="ActivityLogs-EntityTypes">
            <Description>Get available entity types</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/activity-logs/entity-types") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="ActivityLogs-Cleanup">
            <Description>Cleanup old activity logs</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/activity-logs/cleanup") and (request.verb = "DELETE")</Condition>
        </Flow>

        <Flow name="ActivityLogs-ByEntity">
            <Description>Get activity logs by entity</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/activity-logs/entity/**")</Condition>
        </Flow>

        <Flow name="ActivityLogs-ByUser">
            <Description>Get activity logs by user</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/activity-logs/user/*")</Condition>
        </Flow>

        <!-- ==================== Bulk Upload Endpoints ==================== -->
        <Flow name="Bulk-Upload">
            <Description>Bulk upload operations</Description>
            <Request>
                <Step>
                    <Name>JS-ValidateBulkUpload</Name>
                </Step>
            </Request>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/bulk/upload/**") and (request.verb = "POST")</Condition>
        </Flow>

        <Flow name="Bulk-Template">
            <Description>Get bulk upload template</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/bulk/template/**") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Bulk-GCS">
            <Description>GCS bulk upload operations</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/bulk/gcs/**")</Condition>
        </Flow>

        <!-- ==================== Distribution Lists Endpoints ==================== -->
        <Flow name="DistLists-List">
            <Description>List distribution lists</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/distribution-lists") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="DistLists-Create">
            <Description>Create distribution list</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/distribution-lists") and (request.verb = "POST")</Condition>
        </Flow>

        <Flow name="DistLists-Types">
            <Description>Get distribution list types</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/distribution-lists/types") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="DistLists-ByKey">
            <Description>Get distribution list by key</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/distribution-lists/by-key/*") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="DistLists-ByType">
            <Description>Get distribution lists by type</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/distribution-lists/by-type/*") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="DistLists-Emails">
            <Description>Get emails by distribution list key</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/distribution-lists/emails/*") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="DistLists-ToggleStatus">
            <Description>Toggle distribution list status</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/distribution-lists/*/toggle-status") and (request.verb = "POST")</Condition>
        </Flow>

        <Flow name="DistLists-ManageEmails">
            <Description>Add or remove emails from distribution list</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/distribution-lists/*/emails") and (request.verb = "POST" or request.verb = "DELETE")</Condition>
        </Flow>

        <Flow name="DistLists-CRUD">
            <Description>Distribution list CRUD by ID</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/distribution-lists/*")</Condition>
        </Flow>

        <!-- ==================== Error Logs Endpoints ==================== -->
        <Flow name="ErrorLogs-List">
            <Description>List error logs</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/error-logs") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="ErrorLogs-Stats">
            <Description>Get error log statistics</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/error-logs/stats") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="ErrorLogs-Levels">
            <Description>Get available log levels</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/error-logs/levels") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="ErrorLogs-Types">
            <Description>Get distinct error types</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/error-logs/types") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="ErrorLogs-CurrentFile">
            <Description>Get current log file content</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/error-logs/current-file") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="ErrorLogs-ForceArchive">
            <Description>Force archive current log file</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/error-logs/force-archive") and (request.verb = "POST")</Condition>
        </Flow>

        <Flow name="ErrorLogs-Cleanup">
            <Description>Delete old archived logs</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/error-logs/cleanup") and (request.verb = "DELETE")</Condition>
        </Flow>

        <Flow name="ErrorLogs-Archives">
            <Description>List and manage archived log files</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/error-logs/archives") or (proxy.pathsuffix MatchesPath "/error-logs/archives/**")</Condition>
        </Flow>

        <!-- ==================== Prevail Proxy Endpoints ==================== -->
        <Flow name="Prevail-Query">
            <Description>Proxy query to Prevail service</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/prevail/*") and (request.verb = "POST")</Condition>
        </Flow>

        <!-- ==================== Export Endpoints ==================== -->
        <Flow name="Export-Users">
            <Description>Export users data</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/export/users/**")</Condition>
        </Flow>

        <Flow name="Export-Roles">
            <Description>Export roles data</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/export/roles/**")</Condition>
        </Flow>

        <Flow name="Export-Groups">
            <Description>Export groups data</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/export/groups/**")</Condition>
        </Flow>

        <Flow name="Export-Domains">
            <Description>Export domains data</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/export/domains/**")</Condition>
        </Flow>

        <Flow name="Export-Scenarios">
            <Description>Export scenarios data</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/export/scenarios/**")</Condition>
        </Flow>

        <Flow name="Export-ActivityLogs">
            <Description>Export activity logs data</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/export/activity-logs/**")</Condition>
        </Flow>

        <!-- ==================== Jira Integration Endpoints ==================== -->
        <Flow name="Jira-Status">
            <Description>Get Jira connection status</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/jira/status") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Jira-Projects">
            <Description>Get Jira projects</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/jira/projects") or (proxy.pathsuffix MatchesPath "/jira/projects/*")</Condition>
        </Flow>

        <Flow name="Jira-Tasks">
            <Description>Jira tasks operations</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/jira/tasks/**")</Condition>
        </Flow>

        <Flow name="Jira-Attachments">
            <Description>Jira attachments operations</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/jira/attachments/**")</Condition>
        </Flow>

        <Flow name="Jira-IssueTypes">
            <Description>Get Jira issue types</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/jira/issue-types") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Jira-Statuses">
            <Description>Get Jira statuses</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/jira/statuses") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Jira-Boards">
            <Description>Get Jira boards/teams</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/jira/boards") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Jira-AssignableUsers">
            <Description>Get Jira assignable users</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/jira/assignable-users") and (request.verb = "GET")</Condition>
        </Flow>

        <Flow name="Jira-Sync">
            <Description>Sync with Jira</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/jira/sync/**")</Condition>
        </Flow>

        <!-- ==================== Health Check Endpoints ==================== -->
        <Flow name="Health">
            <Description>Health check endpoint</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/health")</Condition>
        </Flow>

        <Flow name="Health-Live">
            <Description>Liveness probe</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/health/live")</Condition>
        </Flow>

        <Flow name="Health-Ready">
            <Description>Readiness probe</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/health/ready")</Condition>
        </Flow>

        <Flow name="Health-Metrics">
            <Description>Health metrics</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/health/metrics")</Condition>
        </Flow>

        <Flow name="Info">
            <Description>Application info</Description>
            <Request/>
            <Response/>
            <Condition>(proxy.pathsuffix MatchesPath "/info")</Condition>
        </Flow>
    </Flows>

    <PostFlow name="PostFlow">
        <Request/>
        <Response>
            <!-- Add security headers -->
            <Step>
                <Name>AM-AddSecurityHeaders</Name>
            </Step>
        </Response>
    </PostFlow>

    <FaultRules>
        <FaultRule name="InvalidAPIKey">
            <Step>
                <Name>AM-InvalidAPIKeyResponse</Name>
            </Step>
            <Condition>(fault.name = "InvalidApiKey") or (fault.name = "InvalidApiKeyForGivenResource")</Condition>
        </FaultRule>
        <FaultRule name="InvalidJWT">
            <Step>
                <Name>AM-InvalidJWTResponse</Name>
            </Step>
            <Condition>(fault.name Matches "*JWT*") or (fault.name Matches "*jwt*")</Condition>
        </FaultRule>
        <FaultRule name="QuotaViolation">
            <Step>
                <Name>AM-QuotaExceededResponse</Name>
            </Step>
            <Condition>(fault.name = "QuotaViolation")</Condition>
        </FaultRule>
        <FaultRule name="SpikeArrestViolation">
            <Step>
                <Name>AM-RateLimitExceededResponse</Name>
            </Step>
            <Condition>(fault.name = "SpikeArrestViolation")</Condition>
        </FaultRule>
    </FaultRules>

    <DefaultFaultRule name="DefaultFaultRule">
        <Step>
            <Name>AM-DefaultErrorResponse</Name>
        </Step>
        <AlwaysEnforce>true</AlwaysEnforce>
    </DefaultFaultRule>

    <HTTPProxyConnection>
        <BasePath>/easylife/v1</BasePath>
        <Properties/>
        <VirtualHost>secure</VirtualHost>
        <VirtualHost>default</VirtualHost>
    </HTTPProxyConnection>

    <RouteRule name="default">
        <TargetEndpoint>default</TargetEndpoint>
    </RouteRule>
    <RouteRule name="noroute">
        <Condition>request.verb == "OPTIONS"</Condition>
    </RouteRule>
</ProxyEndpoint>
